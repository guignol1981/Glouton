let Meal = require('../models/meal/meal');
let mailer = require('../services/mailer-service');

let confirmOrCancelMeals = function() {
	Meal.getLimitDateReached((meals) => {
		meals.forEach(meal => {
			let confirmed = meal.participants.length >= meal.minParticipants;

			if (confirmed) {
				mailer.sendMail({
					from: 'vincentguillemette1981@gmail.com	',
					to: meal.cook.email,
					subject: ` ${meal.cook.name}, your meal named "${meal.title}" is confirmed!`,
					text: 'Congrats! You can go on cooking',
					html: '<b>Congrats! You can go on cooking, we take care of informing the participants</b>'
				});

				meal.confirmed = true;
				meal.canceled = false;
				meal.save();

				meal.participants.forEach(participant => {
					mailer.sendMail({
						from: 'vincentguillemette1981@gmail.com	',
						to: participant.email,
						subject: ` ${participant.name}, the meal named "${meal.title}" that your joined is confirmed!`,
						text: 'The lunch will be delivered on time and don\'t forget to bring your contribution to the cook',
						html: '<b>The lunch will be delivered on time and don\'t forget to bring your contribution to the cook</b>'
					});
				});
			} else {

			}
		});
	});
	console.log('sendMailToCookOnLimitDate executed');
};

let sendMailToCooksOnMinimumParticipantsReached = function() {

};

let sendMailToCooksOnMaximumParticipantsReached = function() {

};

let sendMailToCookWhenMealIsConfirmed = function() {

};

let sendMailToCookWhenMealIsCanceled = function() {

};

let removeUnlinkedImages = function() {

};

module.exports.execute = function() {
	confirmOrCancelMeals();
};