let Meal = require('../models/meal/meal');
let Message = require('../models/message/message');
let mailer = require('../services/mailer-service');

let updateMealStatus = function () {
	Meal.getNewFailed(failed => {
		failed.forEach(failedMeal => {
			failedMeal.status = 'canceled';
			failedMeal.save().then(meal => {
				Message.create({
					recipient: meal.cook._id,
					title: `${meal.cook.name} your lunch proposition ${meal.title} was canceled`,
					type: 'message-meal-canceled',
					category: 'danger',
					data: {
						meal: meal
					}
				});
			});
		});
	});
	console.log('updateMealStatus job done');
};

let minimumParticipantsReached = function () {

};

let maximumParticipantsReached = function () {

};

let removeUnlinkedImages = function () {

};

let suggestMealOnNothingPlannedDays = function () {

};

module.exports.execute = function () {
	updateMealStatus();
};