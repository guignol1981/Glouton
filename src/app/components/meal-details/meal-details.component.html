<div *ngIf="meal" class="container mt-3">
    <app-meal-form [edit]="true" (updated)="onMealUpdated($event)" #mealformedit></app-meal-form>
    <button hidden data-toggle="modal" data-target="#mealformedit" #mealformeditbutton></button>
    <div class="card">
        <div class="row">
            <div class="col">
                <img style="height: auto; width: 300px"
                     [src]="imageService.apiEndPoint + '/' + meal._id"
                     alt="meal img">
            </div>
            <div class="col">
                <div class="card-body">
                    <h5 class="card-title">{{meal.title}}</h5>
                    <p class="card-text">{{meal.description}}</p>
                </div>
                <ul class="list-group list-group-flush">
                    <li class="list-group-item border-0">
                        <button *ngIf="meal.canJoin(user)" (click)="joinMeal()" class="btn btn-primary">Join</button>
                        <button *ngIf="meal.canLeave(user)" (click)="leaveMeal()"
                                class="btn btn-primary">Leave
                        </button>
                    </li>
                    <li *ngIf="! meal.isCook(user)" class="list-group-item border-0">
                        <button class="btn btn-secondary btn-sm" data-toggle="modal" [attr.data-target]="'#messageModal'">
                            write to the cook
                        </button>
                        <app-private-message [author]="user" [recipient]="meal.cook"></app-private-message>
                    </li>
                    <li *ngIf="meal.isCook(user)" class="list-group-item border-0">
                        <button (click)="editMeal(mealformeditbutton)" class="btn btn-secondary btn-sm">edit lunch
                        </button>
                    </li>
                </ul>
            </div>
        </div>
        <ul class="list-group list-group-flush">
            <li class="list-group-item border-0">
                Participants: {{meal.participants.length}}/{{meal.minParticipants}} ({{meal.maxParticipants}}max)
                <div *ngIf="meal.participants.length > 0">
                    <ul class="list-group">
                        <div *ngFor="let participant of meal.participants">
                            {{participant.name}}
                        </div>
                    </ul>
                </div>
            </li>
            <li class="list-group-item border-0">
                This suggestion was posted on
                <span class="badge badge-info">
                        {{meal.creationDate | date}}
                    </span>
            </li>
            <li class="list-group-item border-0">
                This meal will be delivered on
                <span class="badge badge-info">
                        {{meal.deliveryDate | date}}
                    </span>
            </li>
            <li class="list-group-item border-0">
                Users have until
                <span class="badge badge-warning">
                        {{meal.limitDate | date}}
                    </span>
                to subscribe
            </li>
        </ul>
    </div>
</div>